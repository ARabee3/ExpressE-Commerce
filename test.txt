=====================================================
  EXPRESS E-COMMERCE — POSTMAN TEST GUIDE
=====================================================

Replace placeholder values like {{token}}, {{productId}}, etc.
with actual values from previous responses as you go.

Save these variables as you test:
  - {{token}}          → from Register or Login response
  - {{sessionId}}      → from guest Add to Cart response
  - {{categoryId}}     → from Create Category response
  - {{productId1}}     → from first Create Product response
  - {{productId2}}     → from second Create Product response
  - {{cartItemId}}     → from cart response → items[0]._id
  - {{cartId}}         → from cart response → _id
  - {{orderId}}        → from Create Order response

=====================================================
TEST 1: CREATE A CATEGORY (no auth required)
=====================================================
POST http://localhost:3000/categories
Content-Type: application/json

{
  "name": "Electronics" // or gaming
}

Expected: 201
Save: response → data._id as {{categoryId}}

// gaimng : 69978e4d93eac2b26c3dc5a0 (id)

=====================================================
TEST 2: CREATE PRODUCT 1 (no auth required)
=====================================================
POST http://localhost:3000/products
Content-Type: application/json

{
  "name": "Wireless Headphones",
  "description": "High quality noise-cancelling wireless headphones",
  "price": 149.99,
  "stock": 50,
  "images": ["https://example.com/headphones.jpg"],
  "category": "{{categoryId}}"
}

Expected: 201
Save: response → data._id as {{productId1}}

// 69978ede93eac2b26c3dc5a2 (product id)
=====================================================
TEST 3: CREATE PRODUCT 2
=====================================================
POST http://localhost:3000/products
Content-Type: application/json

{
  "name": "USB-C Charger",
  "description": "Fast charging 65W USB-C adapter",
  "price": 29.99,
  "stock": 100,
  "images": ["https://example.com/charger.jpg"],
  "category": "{{categoryId}}"
}

Expected: 201
Save: response → data._id as {{productId2}}

// 69978f5493eac2b26c3dc5a4 (product id)

=====================================================
TEST 4: REGISTER USER
=====================================================
POST http://localhost:3000/register
Content-Type: application/json

{
  "name": "Youssef Test",
  "email": "youssef@test.com",
  "password": "Test@1234",
  "phone": "+201012345678"
}

Expected: 201
Response should include:
  - success: true
  - message about verification email
  - token
  - data (user object without password)
Save: response → token as {{token}}

(token)
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2OTk3OTYzZTA1ZDYxNWFhM2E0YjY5NjkiLCJlbWFpbCI6InlvdXNzZkB0ZXN0LmNvbSIsInJvbGUiOiJDdXN0b21lciIsImlhdCI6MTc3MTU0MjA3OCwiZXhwIjoxNzcxNTQ1Njc4fQ.M1Vv342AdE7NN_YdfQCU6Islasimb98eaf9sOsaKlSc

=====================================================
TEST 5: VERIFY EMAIL
=====================================================
POST http://localhost:3000/verify-email
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "otp": "<get OTP from Redis or your email>"
}

To get OTP from Redis CLI:
  > redis-cli
  > GET youssef@test.com

Expected: 200
  { success: true, message: "Your account has been verified" }

=====================================================
TEST 6: LOGIN (without sessionId — no merge)
=====================================================
POST http://localhost:3000/login
Content-Type: application/json

{
  "email": "youssef@test.com",
  "password": "Test@1234"
}

Expected: 200
  { success: true, data: "<jwt_token>" }
Save: response → data as {{token}}

(login token)
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2OTk3OTYzZTA1ZDYxNWFhM2E0YjY5NjkiLCJlbWFpbCI6InlvdXNlZkB0ZXN0LmNvbSIsInJvbGUiOiJDdXN0b21lciIsImlhdCI6MTc3MTU0MjU1MCwiZXhwIjoxNzcxNTQ2MTUwfQ.MkrDPRLXpokIe3olOihhZBg4ARMPd_09xRcuBcM4l0w
=====================================================
TEST 7: GUEST — ADD TO CART (no Authorization header!)
=====================================================
POST http://localhost:3000/cart
Content-Type: application/json

{
  "productId": "{{productId1}}",
  "quantity": 2
}

Expected: 200
  - status: "success"
  - sessionId: "guest_..." (a generated session ID)
  - data.items has 1 item with quantity 2
Save: response → sessionId as {{sessionId}}

This works because optionalAuth allows requests without a token.

(session id) guest_1771543352141_afqy1c1ug

=====================================================
TEST 8: GUEST — ADD SECOND ITEM (use x-session-id header)
=====================================================
POST http://localhost:3000/cart
x-session-id: {{sessionId}}
Content-Type: application/json

{
  "productId": "{{productId2}}",
  "quantity": 1
}

Expected: 200
  - Cart now has 2 items

=====================================================
TEST 9: GUEST — GET CART
=====================================================
GET http://localhost:3000/cart
x-session-id: {{sessionId}}

Expected: 200
  - items array with 2 products
  - totalPrice = (149.99 * 2) + (29.99 * 1) = 329.97
  - finalPrice = 329.97 (no coupon applied)

=====================================================
TEST 10: GUEST — UPDATE ITEM QUANTITY
=====================================================
First get {{cartItemId}} from Test 9 response → data.items[0]._id

PATCH http://localhost:3000/cart/items/{{cartItemId}}
x-session-id: {{sessionId}}
Content-Type: application/json

{
  "quantity": 3
}

Expected: 200
  - That item's quantity is now 3
  - Totals recalculated

 (cart id ) 69979b38e48e96b447593f51
 (product 1 id in cart ) 69979b38e48e96b447593f52
=====================================================
TEST 11: GUEST — APPLY COUPON
=====================================================
First create a coupon directly in MongoDB:

  db.coupons.insertOne({
    code: "SAVE20",
    discountType: "percentage",
    discount: 20,
    expireDate: new Date("2027-12-31"),
    usageLimit: 100,
    usedCount: 0,
    isActive: true
  })

Then test:

POST http://localhost:3000/cart/coupon
x-session-id: {{sessionId}}
Content-Type: application/json

{
  "couponCode": "SAVE20"
}

Expected: 200
  - message: "Coupon applied successfully"
  - discountAmount = totalPrice * 0.20
  - finalPrice = totalPrice - discountAmount

=====================================================
TEST 12: GUEST — REMOVE COUPON
=====================================================
DELETE http://localhost:3000/cart/coupon
x-session-id: {{sessionId}}

Expected: 200
  - message: "Coupon removed successfully"
  - discountAmount = 0
  - finalPrice = totalPrice

=====================================================
TEST 13: GUEST — REMOVE ITEM FROM CART
=====================================================
DELETE http://localhost:3000/cart/items/{{productId2}}
x-session-id: {{sessionId}}

Expected: 200
  - message: "Item removed from cart"
  - Only productId1 remains in active items

=====================================================
TEST 14: LOGIN WITH SESSION ID (triggers guest cart merge)
=====================================================
POST http://localhost:3000/login
Content-Type: application/json

{
  "email": "youssef@test.com",
  "password": "Test@1234",
  "sessionId": "{{sessionId}}"
}

Expected: 200
  { success: true, data: "<jwt_token>" }
Save: response → data as {{token}}

Behind the scenes: mergeGuestCart() runs and moves
guest cart items into the user's cart.

(merge token ) 
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2OTk3OTYzZTA1ZDYxNWFhM2E0YjY5NjkiLCJlbWFpbCI6InlvdXNlZkB0ZXN0LmNvbSIsInJvbGUiOiJDdXN0b21lciIsImlhdCI6MTc3MTU0NTE0NSwiZXhwIjoxNzcxNTQ4NzQ1fQ.a7_AJFL9VbUqjukFBL2F8nyrDc_4nehRI3CUkpk3fh8

=====================================================
TEST 15: AUTHENTICATED — GET CART (verify merge worked)
=====================================================
GET http://localhost:3000/cart
Authorization: Bearer {{token}}

Expected: 200
  - Cart contains items from the guest cart
  - userId is set (no more sessionId)
Save: response → data._id as {{cartId}}
Save: any item's _id as {{cartItemId}}

=====================================================
TEST 16: AUTHENTICATED — ADD ANOTHER ITEM
=====================================================
POST http://localhost:3000/cart
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "productId": "{{productId2}}",
  "quantity": 1
}

Expected: 200
  - Product2 added back to the user cart
(cart id)
69979b38e48e96b447593f51
=====================================================
TEST 17: AUTHENTICATED — APPLY COUPON AGAIN
=====================================================
POST http://localhost:3000/cart/coupon
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "couponCode": "SAVE20"
}

Expected: 200
  - Coupon applied, discount calculated

=====================================================
TEST 18: CREATE ORDER (checkout via order route)
=====================================================
First get {{cartId}} from Test 15/16 response → data._id

POST http://localhost:3000/orders
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "cartId": "{{cartId}}",
  "shippingAddress": {
    "street": "123 Nile Street",
    "city": "Cairo",
    "state": "Cairo Governorate"
  },
  "paymentMethod": "Cash"
}

Expected: 201
  - status: "success"
  - message: "Order created successfully"
  - data.orderItems contains your products
  - data.totalOrderPrice, discountAmount, finalPrice
  - data.status = "Pending"
Save: response → data._id as {{orderId}}

(cart id)
69979b38e48e96b447593f51

=====================================================
TEST 19: GET USER ORDERS
=====================================================
GET http://localhost:3000/orders
Authorization: Bearer {{token}}

Expected: 200
  - Array of orders for this user
  - Should include the order from Test 18

=====================================================
TEST 20: GET ORDER BY ID
=====================================================
GET http://localhost:3000/orders/{{orderId}}
Authorization: Bearer {{token}}

Expected: 200
  - The specific order details

=====================================================
TEST 21: PAY ORDER
=====================================================
PUT http://localhost:3000/orders/{{orderId}}/pay
Authorization: Bearer {{token}}

Expected: 200
  - isPaid: true
  - paidAt: set
  - status: "Processing"

=====================================================
TEST 22: CANCEL ORDER (create a new order first to test)
=====================================================
First add items to cart again (Tests 16), then create
another order (Test 18), then cancel it:

PUT http://localhost:3000/orders/{{newOrderId}}/cancel
Authorization: Bearer {{token}}

Expected: 200
  - status: "Cancelled"
  - cancelledAt: set
  - Product stock restored

=====================================================
TEST 23: CLEAR CART
=====================================================
First add items to cart, then:

DELETE http://localhost:3000/cart
Authorization: Bearer {{token}}

Expected: 200
  - message: "Cart cleared successfully"

After this, GET /cart should return empty cart.

=====================================================
TEST 24: GET CART AFTER CLEAR (verify empty)
=====================================================
GET http://localhost:3000/cart
Authorization: Bearer {{token}}

Expected: 200
  - items: []
  - totalPrice: 0

=====================================================
  ERROR CASES TO TEST
=====================================================

--- Invalid product ID --- passed
POST http://localhost:3000/cart
Content-Type: application/json
{ "productId": "000000000000000000000000", "quantity": 1 }
Expected: 404 "Product not found"

--- Exceeding stock --- passed
POST http://localhost:3000/cart
Content-Type: application/json
{ "productId": "{{productId1}}", "quantity": 9999 }
Expected: 400 "Insufficient stock..."

--- Invalid coupon code --- passed
POST http://localhost:3000/cart/coupon
Authorization: Bearer {{token}}
Content-Type: application/json
{ "couponCode": "FAKECODE" }
Expected: 404 "Invalid or inactive coupon code"

--- Missing auth on protected route --- passed
GET http://localhost:3000/orders
(no Authorization header)
Expected: 401 "No token provided. Please sign in."

--- Login with wrong password --- passed
POST http://localhost:3000/login
Content-Type: application/json
{ "email": "youssef@test.com", "password": "WrongPass1!" }
Expected: 401 "Email or Password Invalid"

--- Register with weak password --- passed
POST http://localhost:3000/register
Content-Type: application/json
{
  "name": "Bad User",
  "email": "bad@test.com",
  "password": "weak",
  "phone": "+201099999999"
}
Expected: 402 (validation error about password requirements)

--- Register with invalid phone --- passed
POST http://localhost:3000/register
Content-Type: application/json
{
  "name": "Bad Phone",
  "email": "badphone@test.com",
  "password": "Test@1234",
  "phone": "abc"
}
Expected: 402 (validation error about phone format/length)



look at all the endpoints and create a postman JSON test for testing all cases 